<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://lh3.googleusercontent.com; connect-src 'self' http://localhost:* ws://localhost:* https://api.assemblyai.com wss://api.assemblyai.com wss://streaming.assemblyai.com https://api.anthropic.com https://djlvwxmakxaffdqbuwkv.supabase.co wss://djlvwxmakxaffdqbuwkv.supabase.co https://cdn.jsdelivr.net data: blob:; font-src 'self' data:; worker-src 'self' blob: data:; media-src 'self' https://djlvwxmakxaffdqbuwkv.supabase.co blob: data:;">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Top Control Bar -->
        <header class="top-bar">
            <div class="app-title">
                <img src="../../assets/nugget-logo.PNG" alt="ScribeCat Logo" class="app-logo">
                <h1>ScribeCat</h1>
            </div>
            
            <div class="header-actions">
                <button id="signin-btn" class="icon-btn signin-btn" title="Sign In">
                    <span class="signin-icon">üë§</span>
                </button>

                <button id="friends-btn" class="icon-btn" title="Friends" style="display: none;">
                    <span class="friends-icon">üë•</span>
                    <span class="friends-badge" id="friends-badge" style="display: none;">0</span>
                </button>

                <button id="study-rooms-btn" class="icon-btn" title="Study Rooms" style="display: none;">
                    <span class="rooms-icon">üè†</span>
                    <span class="rooms-badge" id="rooms-badge" style="display: none;">0</span>
                </button>

                <button id="study-mode-btn" class="icon-btn" title="Study Mode">
                    <span class="study-icon">üìö</span>
                </button>

                <button id="settings-btn" class="icon-btn" title="Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </button>

                <button id="help-btn" class="icon-btn" title="Help & Legal">
                    <span class="help-icon">‚ùì</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Panel: Notes Editor -->
            <div class="left-panel">
                <div class="panel-header">
                    <h2>Notes</h2>
                    <div id="auto-save-indicator" class="auto-save-indicator" style="display: none;">
                        <span class="auto-save-icon"></span>
                        <span class="auto-save-text">Saved</span>
                    </div>
                    <div class="panel-actions">
                        <!-- Toolbar toggle button hidden - toolbar is always visible now -->
                        <!-- <button id="toggle-toolbar-btn" class="action-btn action-btn-icon" title="Show advanced formatting toolbar">
                            üé®
                        </button> -->
                        <select id="course-select" class="course-select-dropdown" title="Select Course (Optional)">
                            <option value="">No Course Selected</option>
                        </select>
                        <input
                            type="text"
                            id="session-title-input"
                            class="session-title-input"
                            placeholder="Session title (optional)"
                            maxlength="100"
                            title="Enter a title for this recording session"
                        >
                    </div>
                </div>
                
                <div class="formatting-toolbar">
                    <!-- Text Style Group -->
                    <div class="toolbar-group">
                        <button id="bold-btn" class="toolbar-btn" title="Bold ‚Ä¢ Ctrl+B">
                            <span class="btn-icon bold-icon">B</span>
                        </button>
                        <button id="italic-btn" class="toolbar-btn" title="Italic ‚Ä¢ Ctrl+I">
                            <span class="btn-icon italic-icon">I</span>
                        </button>
                        <button id="underline-btn" class="toolbar-btn" title="Underline ‚Ä¢ Ctrl+U">
                            <span class="btn-icon underline-icon">U</span>
                        </button>
                        <button id="strike-btn" class="toolbar-btn" title="Strikethrough ‚Ä¢ Ctrl+Shift+S">
                            <span class="btn-icon strike-icon">S</span>
                        </button>
                        <button id="superscript-btn" class="toolbar-btn" title="Superscript">
                            <span class="btn-icon superscript-icon">X¬≤</span>
                        </button>
                        <button id="subscript-btn" class="toolbar-btn" title="Subscript">
                            <span class="btn-icon subscript-icon">X‚ÇÇ</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Color & Font Size Group -->
                    <div class="toolbar-group">
                        <div class="toolbar-dropdown">
                            <button id="color-btn" class="toolbar-btn" title="Text Color">
                                <span class="btn-icon">A</span>
                            </button>
                            <div id="color-palette" class="editor-color-palette">
                                <!-- Professional color swatches populated by JavaScript -->
                            </div>
                        </div>
                        <div class="toolbar-dropdown">
                            <button id="bg-color-btn" class="toolbar-btn" title="Highlight Color">
                                <span class="btn-icon">üé®</span>
                            </button>
                            <div id="bg-color-palette" class="editor-color-palette">
                                <!-- Professional highlight swatches populated by JavaScript -->
                            </div>
                        </div>
                        <select id="font-size-select" class="font-size-select" title="Font Size">
                            <option value="">Size</option>
                            <option value="12px">12px</option>
                            <option value="14px">14px</option>
                            <option value="16px">16px</option>
                            <option value="18px">18px</option>
                            <option value="20px">20px</option>
                            <option value="24px">24px</option>
                            <option value="28px">28px</option>
                            <option value="32px">32px</option>
                        </select>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Text Align Group -->
                    <div class="toolbar-group">
                        <button id="align-left-btn" class="toolbar-btn" title="Align Left">
                            <span class="btn-icon align-icon align-left">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-center-btn" class="toolbar-btn" title="Align Center">
                            <span class="btn-icon align-icon align-center">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-right-btn" class="toolbar-btn" title="Align Right">
                            <span class="btn-icon align-icon align-right">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-justify-btn" class="toolbar-btn" title="Justify">
                            <span class="btn-icon align-icon align-justify">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Headings Group -->
                    <div class="toolbar-group">
                        <button id="heading1-btn" class="toolbar-btn" title="Heading 1 ‚Ä¢ Ctrl+Shift+H">
                            <span class="btn-icon">H1</span>
                        </button>
                        <button id="heading2-btn" class="toolbar-btn" title="Heading 2 ‚Ä¢ Ctrl+Alt+H">
                            <span class="btn-icon">H2</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- List Group -->
                    <div class="toolbar-group">
                        <button id="bullet-list-btn" class="toolbar-btn" title="Bullet List ‚Ä¢ Ctrl+Shift+8">
                            <span class="btn-icon list-icon">
                                <span class="list-bullet">‚Ä¢</span>
                                <span class="list-lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </span>
                            </span>
                        </button>
                        <button id="numbered-list-btn" class="toolbar-btn" title="Numbered List ‚Ä¢ Ctrl+Shift+7">
                            <span class="btn-icon list-icon">
                                <span class="list-number">1.</span>
                                <span class="list-lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </span>
                            </span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Insert Group -->
                    <div class="toolbar-group">
                        <button id="blockquote-btn" class="toolbar-btn" title="Blockquote ‚Ä¢ Ctrl+Shift+B">
                            <span class="btn-icon">üí¨</span>
                        </button>
                        <button id="code-btn" class="toolbar-btn" title="Inline Code ‚Ä¢ Ctrl+E">
                            <span class="btn-icon">üíª</span>
                        </button>
                        <button id="code-block-btn" class="toolbar-btn" title="Code Block ‚Ä¢ Ctrl+Alt+C">
                            <span class="btn-icon">üìù</span>
                        </button>
                        <button id="divider-btn" class="toolbar-btn" title="Horizontal Rule">
                            <span class="btn-icon">‚ûñ</span>
                        </button>
                        <button id="emoji-btn" class="toolbar-btn" title="Insert Emoji">
                            <span class="btn-icon">üòä</span>
                        </button>
                        <button id="link-btn" class="toolbar-btn" title="Add Link">
                            <span class="btn-icon">üîó</span>
                        </button>
                        <button id="bookmark-btn" class="toolbar-btn" title="Insert Bookmark ‚Ä¢ Ctrl+B">
                            <span class="btn-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                                    <line x1="12" x2="12" y1="7" y2="13"/>
                                    <line x1="15" x2="9" y1="10" y2="10"/>
                                </svg>
                            </span>
                        </button>
                        <button id="image-btn" class="toolbar-btn" title="Insert Image">
                            <span class="btn-icon">üñºÔ∏è</span>
                        </button>
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                        <button id="textbox-btn" class="toolbar-btn" title="Insert Text Box">
                            <span class="btn-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="7" y1="8" x2="17" y2="8"/>
                                    <line x1="7" y1="12" x2="17" y2="12"/>
                                    <line x1="7" y1="16" x2="13" y2="16"/>
                                </svg>
                            </span>
                        </button>
                        <div class="toolbar-dropdown" id="anchor-type-dropdown" style="display: none;">
                            <button id="anchor-type-btn" class="toolbar-btn" title="Image Anchor">
                                <span class="btn-icon">‚öì</span>
                            </button>
                            <div id="anchor-type-palette" class="anchor-palette">
                                <div class="anchor-option" data-anchor="paragraph" title="Paragraph - anchored to paragraph with text wrapping">
                                    <span class="anchor-icon">üìÑ</span>
                                    <span class="anchor-label">Paragraph</span>
                                </div>
                                <div class="anchor-option" data-anchor="page" title="Page - free positioning anywhere on page">
                                    <span class="anchor-icon">üìç</span>
                                    <span class="anchor-label">Page</span>
                                </div>
                                <div class="anchor-option" data-anchor="inline" title="Inline - flows with text like a character">
                                    <span class="anchor-icon">üìù</span>
                                    <span class="anchor-label">Inline</span>
                                </div>
                            </div>
                        </div>
                        <div class="toolbar-dropdown" id="wrap-type-dropdown" style="display: none;">
                            <button id="wrap-type-btn" class="toolbar-btn" title="Spacing">
                                <span class="btn-icon">‚ÜîÔ∏è</span>
                            </button>
                            <div id="wrap-type-palette" class="wrap-palette">
                                <div class="wrap-option" data-wrap="square" title="Normal spacing (16px margins)">
                                    <span class="wrap-icon">‚ñ¢</span>
                                    <span class="wrap-label">Normal</span>
                                </div>
                                <div class="wrap-option" data-wrap="tight" title="Tight spacing (8px margins)">
                                    <span class="wrap-icon">‚ñ£</span>
                                    <span class="wrap-label">Tight</span>
                                </div>
                            </div>
                        </div>
                        <!-- Image Alignment Buttons -->
                        <button id="image-align-left-btn" class="toolbar-btn" title="Align Left" style="display: none;">
                            <span class="btn-icon">‚¨Ö</span>
                        </button>
                        <button id="image-align-right-btn" class="toolbar-btn" title="Align Right" style="display: none;">
                            <span class="btn-icon">‚û°</span>
                        </button>
                        <!-- Image Position Fine-Tuning -->
                        <button id="image-indent-btn" class="toolbar-btn" title="Move Inward" style="display: none;">
                            <span class="btn-icon">‚á§</span>
                        </button>
                        <button id="image-outdent-btn" class="toolbar-btn" title="Move Outward" style="display: none;">
                            <span class="btn-icon">‚á•</span>
                        </button>
                        <button id="insert-table-btn" class="toolbar-btn" title="Insert Table">
                            <span class="btn-icon">‚äû</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- History Group -->
                    <div class="toolbar-group">
                        <button id="undo-btn" class="toolbar-btn" title="Undo ‚Ä¢ Ctrl+Z">
                            <span class="btn-icon">‚Ü∂</span>
                        </button>
                        <button id="redo-btn" class="toolbar-btn" title="Redo ‚Ä¢ Ctrl+Y">
                            <span class="btn-icon">‚Ü∑</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Clear Format -->
                    <button id="clear-format-btn" class="toolbar-btn" title="Clear Formatting">
                        <span class="btn-icon">‚úï</span>
                    </button>
                </div>

                <!-- Table Toolbar (contextual - only shows when in table) -->
                <div id="table-toolbar" class="table-toolbar" style="display: none;">
                    <div class="toolbar-group">
                        <button id="add-row-before-btn" class="toolbar-btn" title="Add Row Above">
                            <span class="btn-icon">‚¨Ü Row</span>
                        </button>
                        <button id="add-row-after-btn" class="toolbar-btn" title="Add Row Below">
                            <span class="btn-icon">‚¨á Row</span>
                        </button>
                        <button id="add-col-before-btn" class="toolbar-btn" title="Add Column Left">
                            <span class="btn-icon">‚¨Ö Col</span>
                        </button>
                        <button id="add-col-after-btn" class="toolbar-btn" title="Add Column Right">
                            <span class="btn-icon">‚û° Col</span>
                        </button>
                        <button id="delete-row-btn" class="toolbar-btn" title="Delete Row">
                            <span class="btn-icon">‚ùå Row</span>
                        </button>
                        <button id="delete-col-btn" class="toolbar-btn" title="Delete Column">
                            <span class="btn-icon">‚ùå Col</span>
                        </button>
                        <button id="delete-table-btn" class="toolbar-btn" title="Delete Table">
                            <span class="btn-icon">üóë Table</span>
                        </button>
                    </div>
                </div>
                
                <div id="tiptap-editor" class="tiptap-editor"></div>
                
                <div class="editor-footer">
                    <span id="char-count" class="count-display">0 characters</span>
                    <span class="count-separator">‚Ä¢</span>
                    <span id="word-count" class="count-display">0 words</span>
                </div>
            </div>
            
            <!-- Right Panel: Live Transcription -->
            <div class="right-panel">
                <div class="panel-header">
                    <h2>Live Transcription</h2>
                    <div class="panel-actions">
                        <button id="new-session-btn" class="action-btn" title="Start a new session (saves current work)" disabled>
                            üìù New Session
                        </button>
                    </div>
                </div>
                
                <div class="recording-controls-bar">
                    <button id="record-btn" class="record-btn" title="Start Recording">
                        <span class="record-icon"></span>
                    </button>
                    
                    <button id="pause-btn" class="pause-btn" title="Pause Recording" disabled>
                        <span class="pause-icon">‚è∏</span>
                    </button>
                    
                    <select id="microphone-select" class="device-select" title="Select Microphone">
                        <option value="">üê± Cats can rotate their ears 180 degrees...</option>
                    </select>
                    
                    <div class="vu-meter-container">
                        <div class="vu-meter-bg">
                            <div id="vu-meter" class="vu-meter"></div>
                        </div>
                    </div>
                </div>
                
                <div id="transcription-container" class="transcription-container">
                    <div class="transcription-placeholder" id="transcription-placeholder">
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Study Mode View -->
        <div id="study-mode-view" class="study-mode-view hidden">
            <div class="study-mode-header">
                <h2>üìö Study Mode</h2>
                <div class="study-mode-header-actions">
                    <div id="online-status-indicator" class="online-status-indicator online">
                        <span class="status-dot"></span>
                        <span class="status-text">Online</span>
                    </div>
                    <button id="trash-btn" class="secondary-btn" title="View trash">
                        üóëÔ∏è Trash
                    </button>
                    <button id="analytics-btn" class="secondary-btn" title="View study analytics">
                        üìä Analytics
                    </button>
                    <button id="sync-now-btn" class="secondary-btn" title="Sync with cloud">
                        <span class="sync-icon">‚òÅÔ∏è</span> Sync Now
                    </button>
                    <button id="back-to-record-btn" class="secondary-btn">‚Üê Back to Recording</button>
                </div>
            </div>
            
            <!-- Phase 3: Advanced Search & View Modes -->
            <div class="study-mode-controls">
                <!-- Advanced Search Bar (replaces basic search) -->
                <div id="advanced-search-container"></div>

                <!-- Filter & Sort Controls -->
                <div id="filter-sort-container" class="filter-sort-wrapper"></div>

                <!-- View Mode Switcher -->
                <div id="view-mode-switcher-container" class="view-mode-switcher-wrapper"></div>
            </div>

            <!-- Legacy filters (kept for backwards compatibility) -->
            <div class="study-mode-filters hidden">
                <select id="study-sharing-filter" class="filter-select" aria-label="Filter by sharing status">
                    <option value="all">All Sessions</option>
                    <option value="my-sessions">My Sessions</option>
                    <option value="shared-with-me">Shared with Me</option>
                    <option value="shared-by-me">Shared by Me</option>
                </select>
                <select id="study-course-filter" class="filter-select" aria-label="Filter by course">
                    <option value="">All Courses</option>
                </select>
                <select id="study-sort-select" class="filter-select" aria-label="Sort sessions">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="longest">Longest First</option>
                    <option value="shortest">Shortest First</option>
                </select>
            </div>
            
            <div class="bulk-actions-bar hidden" id="bulk-actions-bar">
                <div class="bulk-actions-left">
                    <label class="checkbox-label">
                        <input type="checkbox" id="select-all-sessions">
                        <span id="selected-count">0 selected</span>
                    </label>
                </div>
                <div class="bulk-actions-right">
                    <button id="create-study-set-btn" class="action-btn study-set-btn" disabled>
                        üìö Create Study Set
                    </button>
                    <button id="bulk-export-btn" class="action-btn" disabled>
                        üì§ Export Selected
                    </button>
                    <button id="bulk-delete-btn" class="action-btn delete-btn" disabled>
                        üóëÔ∏è Delete Selected
                    </button>
                </div>
            </div>
            
            <div id="session-list" class="session-list">
                <!-- Session cards will be populated by JavaScript -->
            </div>
            
            <div id="session-detail" class="session-detail hidden">
                <!-- Session detail view will be populated by JavaScript -->
            </div>

            <!-- Analytics Modal -->
            <div id="analytics-modal" class="analytics-modal hidden">
                <div class="analytics-modal-overlay"></div>
                <div class="analytics-modal-content">
                    <div class="analytics-modal-header">
                        <h2>üìä Study Analytics</h2>
                        <button id="close-analytics-btn" class="close-modal-btn" title="Close">√ó</button>
                    </div>
                    <div id="analytics-dashboard-container" class="analytics-modal-body">
                        <!-- Dashboard content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-label">Status:</span>
                <span id="recording-status" class="status-value">Idle</span>
                <span id="transcription-mode" class="mode-indicator"></span>
            </div>

            <div class="status-center">
                <span class="status-label">Time:</span>
                <span id="elapsed-time" class="status-value time-display">00:00</span>
            </div>

            <div class="status-notification-ticker">
                <div id="notification-ticker-content"></div>
                <span id="notification-queue-count" class="queue-badge"></span>
            </div>

            <div class="status-right">
                <span id="session-info" class="status-value"></span>
            </div>
        </footer>
    </div>
    
    <!-- Floating AI Chat Button -->
    <button id="floating-chat-btn" class="floating-chat-btn" title="Open Nugget" aria-label="Open Nugget">
        <img src="assets/AskNugget-cat.PNG" alt="Nugget" class="chat-btn-icon">
        <span class="chat-badge" id="chat-badge" hidden>0</span>
    </button>
    
    <!-- AI Chat Drawer -->
    <div id="ai-chat-drawer" class="ai-chat-drawer hidden">
        <div class="drawer-backdrop"></div>
        <div class="drawer-content">
            <div class="drawer-header">
                <h3>Nugget</h3>
                <button id="close-drawer-btn" class="close-drawer-btn" title="Close chat" aria-label="Close chat">√ó</button>
            </div>

            <!-- Tab Navigation -->
            <div class="chat-tabs">
                <button id="chat-tab-btn" class="chat-tab active" data-tab="chat">
                    üí¨ Chat
                </button>
                <button id="suggestions-tab-btn" class="chat-tab" data-tab="suggestions">
                    ‚ú® Live AI
                    <span class="suggestions-badge" id="suggestions-badge" hidden>0</span>
                </button>
            </div>

            <!-- Chat Tab Content -->
            <div id="chat-tab-content" class="chat-tab-content active">
                <div id="chat-messages" class="chat-messages">
                    <div class="chat-welcome">
                        <p>üëã Hi! I'm Nugget, your AI study companion. I can help you understand your transcription and notes better.</p>
                        <p>Ask me anything about the content!</p>
                    </div>
                </div>

                <div class="chat-input-container">
                    <input
                        type="text"
                        id="chat-input"
                        class="chat-input"
                        placeholder="Ask Nugget about your transcription or notes..."
                        disabled
                        aria-label="Chat message input"
                    >
                    <button id="send-chat-btn" class="send-chat-btn" title="Send message" aria-label="Send message" disabled>
                        ‚û§
                    </button>
                </div>

                <div class="chat-options">
                    <label class="chat-option-label">
                        <input type="checkbox" id="include-transcription" checked>
                        <span>Include transcription context</span>
                    </label>
                    <label class="chat-option-label">
                        <input type="checkbox" id="include-notes" checked>
                        <span>Include notes context</span>
                    </label>
                </div>
            </div>

            <!-- Suggestions Tab Content -->
            <div id="suggestions-tab-content" class="chat-tab-content">
                <div id="live-suggestions-panel" class="live-suggestions-panel"></div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="close-settings-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <!-- Collapsible Group: Transcription & AI -->
                <div class="settings-group" data-group="transcription-ai">
                    <div class="settings-group-header">
                        <h2>Transcription & AI</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Transcription Mode Section -->
                        <section class="settings-section">
                            <h3>Transcription Mode</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="assemblyai" id="mode-assemblyai" checked>
                            <span class="radio-text">
                                <strong>AssemblyAI</strong>
                                <small>Real-time streaming, word-by-word display</small>
                            </span>
                        </label>
                    </div>
                    <p class="help-text">
                        AssemblyAI provides real-time streaming transcription with word-by-word display. API key required.
                    </p>
                </section>

                        <!-- Transcription Accuracy Settings Section -->
                        <section class="settings-section">
                            <h3>Transcription Accuracy Settings</h3>
                            <p class="help-text" style="margin-bottom: 15px;">
                                Configure AssemblyAI transcription parameters for improved accuracy. These settings only apply when AssemblyAI mode is selected.
                            </p>

                            <!-- Speech Model selector removed - not supported in v3 WebSocket API -->

                            <div class="form-group">
                                <label for="language-select">Language:</label>
                                <select id="language-select" class="text-input">
                                    <option value="">Auto-detect</option>
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="nl">Dutch</option>
                                    <option value="hi">Hindi</option>
                                    <option value="ja">Japanese</option>
                                    <option value="zh">Chinese</option>
                                    <option value="fi">Finnish</option>
                                    <option value="ko">Korean</option>
                                    <option value="pl">Polish</option>
                                    <option value="ru">Russian</option>
                                    <option value="tr">Turkish</option>
                                    <option value="uk">Ukrainian</option>
                                    <option value="vi">Vietnamese</option>
                                </select>
                                <small class="help-text">
                                    Specify the language for better accuracy, or use auto-detect.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="keyterms-input">Custom Vocabulary (BETA):</label>
                                <textarea
                                    id="keyterms-input"
                                    class="text-input"
                                    rows="3"
                                    placeholder="Enter terms separated by commas (e.g., ScribeCat, Anthropic, TypeScript, Claude)"
                                ></textarea>
                                <small class="help-text">
                                    Boost accuracy for course-specific terms, professor names, or technical jargon. Separate terms with commas. Each term must be 5-50 characters. Max 100 terms.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="speaker-labels-checkbox" disabled>
                                    <span>Enable Speaker Diarization</span>
                                </label>
                                <small class="help-text" style="color: #888;">
                                    Not available for real-time streaming. Speaker diarization is only supported for pre-recorded audio files or multi-channel streaming.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="disfluencies-checkbox" checked>
                                    <span>Filter Filler Words</span>
                                </label>
                                <small class="help-text">
                                    Remove "um", "uh", and other filler words for cleaner transcripts.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="punctuate-checkbox" checked>
                                    <span>Automatic Punctuation</span>
                                </label>
                                <small class="help-text">
                                    Automatically add punctuation to transcripts.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="format-text-checkbox" checked>
                                    <span>Smart Text Formatting</span>
                                </label>
                                <small class="help-text">
                                    Enable smart formatting for numbers, dates, and other entities.
                                </small>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Collapsible Group: Integrations -->
                <div class="settings-group" data-group="integrations">
                    <div class="settings-group-header">
                        <h2>Integrations</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Google Drive Settings Section -->
                        <section class="settings-section" id="google-drive-settings">
                            <h3>Google Drive Integration</h3>
                    <div class="status-row">
                        <label>Status:</label>
                        <span id="drive-status" class="status-text">Not connected</span>
                    </div>
                    <div class="button-row">
                        <button id="connect-drive-btn" class="button button-primary" type="button">
                            Connect Google Drive
                        </button>
                        <button id="disconnect-drive-btn" class="button button-secondary" type="button" style="display: none;">
                            Disconnect
                        </button>
                    </div>
                    <p class="help-text">
                        Connect your Google Drive to automatically upload exported sessions. 
                        You'll be asked to sign in with your Google account.
                    </p>
                </section>
                
                <!-- Canvas LMS Settings Section -->
                <section class="settings-section" id="canvas-settings">
                    <h3>Canvas LMS Integration</h3>
                    
                    <!-- API Connection Method -->
                    <div class="canvas-method">
                        <h4>Method 1: Canvas API (Recommended)</h4>
                        <div class="form-group">
                            <label for="canvas-url">Canvas URL:</label>
                            <input 
                                type="text" 
                                id="canvas-url" 
                                class="text-input" 
                                placeholder="https://canvas.instructure.com"
                            >
                            <small class="help-text">
                                Enter your institution's Canvas URL (e.g., https://canvas.university.edu)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="canvas-token">API Token:</label>
                            <input 
                                type="password" 
                                id="canvas-token" 
                                class="text-input" 
                                placeholder="Enter your Canvas API token"
                            >
                            <small class="help-text">
                                Get your API token from Canvas: Account ‚Üí Settings ‚Üí New Access Token
                            </small>
                        </div>
                        <div class="status-row">
                            <label>Status:</label>
                            <span id="canvas-status" class="status-text">Not configured</span>
                        </div>
                        <div class="button-row">
                            <button id="test-canvas-btn" class="button button-secondary" type="button">
                                Test Connection
                            </button>
                            <button id="disconnect-canvas-btn" class="button button-secondary" type="button" style="display: none;">
                                Disconnect
                            </button>
                        </div>
                    </div>
                    
                    <!-- Browser Extension Import Method -->
                    <div class="canvas-method" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #444;">
                        <h4>Method 2: Browser Extension Import</h4>
                        <p class="help-text">
                            If your university blocks Canvas API access, use our browser extension to import courses.
                            <a href="#" id="extension-help-link" style="color: #3498db;">Learn more</a>
                        </p>
                        <div class="form-group">
                            <label for="canvas-import-json">Paste JSON from Extension:</label>
                            <textarea 
                                id="canvas-import-json" 
                                class="text-input" 
                                rows="4"
                                placeholder='{"source": "ScribeCat Canvas Browser Extension", "format": "scribecat_course_import_v1", "courses": [...]}'
                            ></textarea>
                            <small class="help-text">
                                Install the extension, visit your Canvas dashboard, export courses, then paste the JSON here.
                            </small>
                        </div>
                        <div class="button-row">
                            <button id="import-canvas-courses-btn" class="button button-primary" type="button">
                                Import Courses
                            </button>
                        </div>
                        
                        <!-- Imported Courses List -->
                        <div id="imported-courses-container" style="margin-top: 20px; display: none;">
                            <h5>Imported Courses (<span id="imported-courses-count">0</span>)</h5>
                            <div id="imported-courses-list" class="courses-list"></div>
                        </div>
                    </div>
                </section>
                    </div>
                </div>

                <!-- Collapsible Group: Appearance -->
                <div class="settings-group" data-group="appearance">
                    <div class="settings-group-header">
                        <h2>Appearance</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Workspace Layout Section -->
                        <section class="settings-section">
                            <h3>Workspace Layout</h3>
                            <p class="help-text">
                                Customize your workspace layout with presets or create your own. Drag the divider between panels to resize.
                            </p>
                            <div class="button-row">
                                <button id="open-layout-picker-btn" class="button button-primary" type="button">
                                    ‚äû Manage Workspace Layouts
                                </button>
                            </div>
                        </section>

                        <!-- Theme Settings Section -->
                        <section class="settings-section">
                            <h3>Themes</h3>
                            <p class="help-text">
                                Choose a theme that matches your mood and enhances your focus.
                                Each theme is designed using color theory to evoke specific emotions.
                            </p>

                            <!-- Calm & Peaceful Themes -->
                            <div class="theme-category-section" data-category="calm">
                                <div class="theme-category-header">
                                    <h4>Calm & Peaceful</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="calm">
                                        <!-- Calm themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Energetic & Motivated Themes -->
                            <div class="theme-category-section" data-category="energetic">
                                <div class="theme-category-header">
                                    <h4>Energetic & Motivated</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="energetic">
                                        <!-- Energetic themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Focus & Productivity Themes -->
                            <div class="theme-category-section" data-category="focus">
                                <div class="theme-category-header">
                                    <h4>Focus & Productivity</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="focus">
                                        <!-- Focus themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Creative & Inspired Themes -->
                            <div class="theme-category-section" data-category="creative">
                                <div class="theme-category-header">
                                    <h4>Creative & Inspired</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="creative">
                                        <!-- Creative themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Balanced & Harmonious Themes -->
                            <div class="theme-category-section" data-category="balanced">
                                <div class="theme-category-header">
                                    <h4>Balanced & Harmonious</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="balanced">
                                        <!-- Balanced themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- High Contrast Themes -->
                            <div class="theme-category-section" data-category="high-contrast">
                                <div class="theme-category-header">
                                    <h4>High Contrast</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="high-contrast">
                                        <!-- High contrast themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Special Themes -->
                            <div class="theme-category-section" data-category="special">
                                <div class="theme-category-header">
                                    <h4>Special</h4>
                                    <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="theme-category-content">
                                    <div class="theme-grid" data-category-grid="special">
                                        <!-- Special themes populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Collapsible Group: Audio Configuration -->
                <div class="settings-group" data-group="audio">
                    <div class="settings-group-header">
                        <h2>Audio Configuration</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Audio Settings Section -->
                        <section class="settings-section">
                            <h3>Recording Configuration</h3>

                    <div class="info-row">
                        <span class="info-label">Sample Rate:</span>
                        <span class="info-value" id="sample-rate-display">16000 Hz</span>
                    </div>

                    <div class="info-row">
                        <span class="info-label">Audio Format:</span>
                        <span class="info-value">PCM 16-bit Mono</span>
                    </div>
                </section>

                        <!-- Sound Effects Section -->
                        <section class="settings-section">
                            <h3>Sound Effects</h3>
                            <p class="help-text">
                                Enable cat-themed sound effects for success messages, errors, and notifications.
                            </p>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="sound-effects-checkbox" checked>
                                    <span>Enable sound effects</span>
                                </label>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Collapsible Group: Account -->
                <div class="settings-group" data-group="account">
                    <div class="settings-group-header">
                        <h2>Account</h2>
                        <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <section class="settings-section">
                            <h3>Account Management</h3>
                            <p class="help-text">
                                Manage your account settings, profile information, and account deletion.
                            </p>
                            <button id="manage-account-btn" class="secondary-btn" style="margin-top: 10px;">
                                Manage Account Settings
                            </button>
                        </section>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-settings-btn" class="secondary-btn">Cancel</button>
                <button id="save-settings-btn" class="primary-btn">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Input Prompt Modal -->
    <div id="input-prompt-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="input-prompt-title">Enter Value</h2>
                <button id="close-input-prompt-btn" class="close-btn" title="Close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label id="input-prompt-label" for="input-prompt-field">Value:</label>
                    <input type="text" id="input-prompt-field" class="text-input" placeholder="">
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-input-prompt-btn" class="secondary-btn">Cancel</button>
                <button id="ok-input-prompt-btn" class="primary-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Course Selection Modal -->
    <div id="course-select-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Course</h2>
                <button id="close-course-select-btn" class="close-btn" title="Close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label for="course-select-dropdown">Select Course:</label>
                    <select id="course-select-dropdown" class="course-select-dropdown">
                        <option value="">No Course Selected</option>
                    </select>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-course-select-btn" class="secondary-btn">Cancel</button>
                <button id="ok-course-select-btn" class="primary-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Help & Legal Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Help & Legal</h2>
                <button id="close-help-btn" class="close-btn" title="Close">√ó</button>
            </div>

            <div class="modal-body">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button id="about-tab" class="tab-btn active" data-tab="about">About</button>
                    <button id="help-tab" class="tab-btn" data-tab="help">Help</button>
                    <button id="privacy-tab" class="tab-btn" data-tab="privacy">Privacy Policy</button>
                    <button id="terms-tab" class="tab-btn" data-tab="terms">Terms of Service</button>
                </div>

                <!-- Tab Content -->
                <div id="about-content" class="tab-content active">
                    <div class="legal-document" id="about-document">
                        <!-- About content will be populated by JavaScript -->
                    </div>
                </div>

                <div id="help-content" class="tab-content hidden">
                    <div class="legal-document" id="help-document">
                        <!-- Help content will be populated by JavaScript -->
                    </div>
                </div>

                <div id="privacy-content" class="tab-content hidden">
                    <div class="legal-document" id="privacy-document">
                        <!-- Privacy policy will be loaded here -->
                    </div>
                </div>

                <div id="terms-content" class="tab-content hidden">
                    <div class="legal-document" id="terms-document">
                        <!-- Terms of service will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="close-help-modal-btn" class="secondary-btn">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
