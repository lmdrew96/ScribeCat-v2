<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' http://localhost:* ws://localhost:* data: blob:; font-src 'self' data:; worker-src 'self' blob: data:;">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Top Control Bar -->
        <header class="top-bar">
            <div class="app-title">
                <span class="cat-emoji">üê±</span>
                <h1>ScribeCat</h1>
            </div>
            
            <div class="recording-controls">
                <button id="record-btn" class="record-btn" title="Start Recording">
                    <span class="record-icon"></span>
                </button>
                
                <select id="microphone-select" class="device-select" title="Select Microphone">
                    <option value="">Loading devices...</option>
                </select>
                
                <div class="vu-meter-container">
                    <div class="vu-meter-bg">
                        <div id="vu-meter" class="vu-meter"></div>
                    </div>
                </div>
                
                <button id="settings-btn" class="icon-btn" title="Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Panel: Notes Editor -->
            <div class="left-panel">
                <div class="panel-header">
                    <h2>Notes</h2>
                </div>
                
                <div class="formatting-toolbar">
                    <button id="bold-btn" class="toolbar-btn" title="Bold (Ctrl+B)">
                        <strong>B</strong>
                    </button>
                    <button id="italic-btn" class="toolbar-btn" title="Italic (Ctrl+I)">
                        <em>I</em>
                    </button>
                    <button id="underline-btn" class="toolbar-btn" title="Underline (Ctrl+U)">
                        <u>U</u>
                    </button>
                    
                    <div class="toolbar-divider"></div>
                    
                    <select id="font-size-select" class="toolbar-select" title="Font Size">
                        <option value="12">12</option>
                        <option value="14">14</option>
                        <option value="16" selected>16</option>
                        <option value="18">18</option>
                        <option value="20">20</option>
                        <option value="24">24</option>
                    </select>
                    
                    <input type="color" id="text-color-picker" class="color-picker" value="#ffffff" title="Text Color">
                </div>
                
                <div id="notes-editor" class="notes-editor" contenteditable="true" spellcheck="true">
                    Start taking notes here...
                </div>
                
                <div class="editor-footer">
                    <span id="char-count" class="count-display">0 characters</span>
                    <span class="count-separator">‚Ä¢</span>
                    <span id="word-count" class="count-display">0 words</span>
                </div>
            </div>
            
            <!-- Right Panel: Live Transcription -->
            <div class="right-panel">
                <div class="panel-header">
                    <h2>Live Transcription</h2>
                </div>
                
                <div id="transcription-container" class="transcription-container">
                    <div class="transcription-placeholder">
                        Waiting for transcription...
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-label">Status:</span>
                <span id="recording-status" class="status-value">Idle</span>
                <span id="transcription-mode" class="mode-indicator"></span>
            </div>
            
            <div class="status-center">
                <span class="status-label">Time:</span>
                <span id="elapsed-time" class="status-value time-display">00:00</span>
            </div>
            
            <div class="status-right">
                <span id="session-info" class="status-value"></span>
            </div>
        </footer>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="close-settings-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <!-- Transcription Mode Section -->
                <section class="settings-section">
                    <h3>Transcription Mode</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="simulation" id="mode-simulation" checked>
                            <span class="radio-text">
                                <strong>Simulation Mode</strong>
                                <small>Testing mode with fake transcription</small>
                            </span>
                        </label>
                        
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="whisper" id="mode-whisper">
                            <span class="radio-text">
                                <strong>Whisper</strong>
                                <small>Offline, high accuracy (~2-5s delay)</small>
                            </span>
                        </label>
                        
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="vosk" id="mode-vosk">
                            <span class="radio-text">
                                <strong>Vosk</strong>
                                <small>Real-time, experimental</small>
                            </span>
                        </label>
                    </div>
                    <p class="help-text">
                        Simulation mode is for testing. Whisper provides excellent accuracy offline. 
                        Vosk is faster but less accurate.
                    </p>
                </section>
                
                <!-- Whisper Model Management Section -->
                <section class="settings-section" id="whisper-settings">
                    <h3>Whisper Model</h3>
                    <div class="model-status-container">
                        <div class="status-row">
                            <label>Status:</label>
                            <span id="whisper-model-status" class="status-text">Checking...</span>
                        </div>
                        <div class="button-row">
                            <button id="download-whisper-model" class="button button-primary" type="button">
                                Download Base Model (~142MB)
                            </button>
                        </div>
                    </div>
                    <div id="whisper-download-progress" class="progress-container" style="display: none;">
                        <div class="progress-bar">
                            <div id="whisper-progress-fill" class="progress-fill"></div>
                        </div>
                        <span id="whisper-progress-text" class="progress-text">0%</span>
                    </div>
                    <p class="help-text">
                        The base model provides excellent transcription accuracy for English. 
                        Download once and use offline.
                    </p>
                </section>
                
                <!-- Vosk Model Settings Section (Dynamic) -->
                <div id="vosk-model-settings-container"></div>
                
                <!-- Audio Settings Section -->
                <section class="settings-section">
                    <h3>Audio Configuration</h3>
                    
                    <div class="info-row">
                        <span class="info-label">Sample Rate:</span>
                        <span class="info-value" id="sample-rate-display">16000 Hz (Vosk required)</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Audio Format:</span>
                        <span class="info-value">PCM 16-bit Mono</span>
                    </div>
                </section>
            </div>
            
            <div class="modal-footer">
                <button id="cancel-settings-btn" class="secondary-btn">Cancel</button>
                <button id="save-settings-btn" class="primary-btn">Save Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Model URL Edit Modal -->
    <div id="model-url-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Model URL</h2>
                <button id="close-model-url-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="model-url-input">Model URL:</label>
                    <input 
                        type="text" 
                        id="model-url-input" 
                        class="text-input" 
                        placeholder="http://localhost:8000/vosk-model-small-en-us-0.15"
                    >
                    <small class="help-text">
                        Enter the HTTP URL where your Vosk model is served
                    </small>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="cancel-model-url-btn" class="secondary-btn">Cancel</button>
                <button id="save-model-url-btn" class="primary-btn">Save URL</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="app.js"></script>
</body>
</html>
