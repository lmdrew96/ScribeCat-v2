<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' http://localhost:* ws://localhost:* https://api.assemblyai.com wss://api.assemblyai.com wss://streaming.assemblyai.com https://api.anthropic.com data: blob:; font-src 'self' data:; worker-src 'self' blob: data:;">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Top Control Bar -->
        <header class="top-bar">
            <div class="app-title">
                <span class="cat-emoji">üê±</span>
                <h1>ScribeCat</h1>
            </div>
            
            <div class="recording-controls">
                <button id="record-btn" class="record-btn" title="Start Recording">
                    <span class="record-icon"></span>
                </button>
                
                <select id="microphone-select" class="device-select" title="Select Microphone">
                    <option value="">Loading devices...</option>
                </select>
                
                <div class="vu-meter-container">
                    <div class="vu-meter-bg">
                        <div id="vu-meter" class="vu-meter"></div>
                    </div>
                </div>
                
                <button id="settings-btn" class="icon-btn" title="Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Panel: Notes Editor -->
            <div class="left-panel">
                <div class="panel-header">
                    <h2>Notes</h2>
                </div>
                
                <div class="formatting-toolbar">
                    <button id="bold-btn" class="toolbar-btn" title="Bold (Ctrl+B)">
                        <strong>B</strong>
                    </button>
                    <button id="italic-btn" class="toolbar-btn" title="Italic (Ctrl+I)">
                        <em>I</em>
                    </button>
                    <button id="underline-btn" class="toolbar-btn" title="Underline (Ctrl+U)">
                        <u>U</u>
                    </button>
                    
                    <div class="toolbar-divider"></div>
                    
                    <select id="font-size-select" class="toolbar-select" title="Font Size">
                        <option value="12">12</option>
                        <option value="14">14</option>
                        <option value="16" selected>16</option>
                        <option value="18">18</option>
                        <option value="20">20</option>
                        <option value="24">24</option>
                    </select>
                    
                    <input type="color" id="text-color-picker" class="color-picker" value="#ffffff" title="Text Color">
                </div>
                
                <div id="notes-editor" class="notes-editor" contenteditable="true" spellcheck="true">
                    Start taking notes here...
                </div>
                
                <div class="editor-footer">
                    <span id="char-count" class="count-display">0 characters</span>
                    <span class="count-separator">‚Ä¢</span>
                    <span id="word-count" class="count-display">0 words</span>
                </div>
            </div>
            
            <!-- Right Panel: Live Transcription -->
            <div class="right-panel">
                <div class="panel-header">
                    <h2>Live Transcription</h2>
                    <div class="panel-actions">
                        <button id="polish-btn" class="action-btn" title="Polish transcription with AI" disabled>
                            ‚ú® Polish
                        </button>
                        <button id="summarize-btn" class="action-btn" title="Generate summary" disabled>
                            üìù Summarize
                        </button>
                    </div>
                </div>
                
                <div id="transcription-container" class="transcription-container">
                    <div class="transcription-placeholder">
                        Waiting for transcription...
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-label">Status:</span>
                <span id="recording-status" class="status-value">Idle</span>
                <span id="transcription-mode" class="mode-indicator"></span>
            </div>
            
            <div class="status-center">
                <span class="status-label">Time:</span>
                <span id="elapsed-time" class="status-value time-display">00:00</span>
            </div>
            
            <div class="status-right">
                <span id="session-info" class="status-value"></span>
            </div>
        </footer>
    </div>
    
    <!-- Floating AI Chat Button -->
    <button id="floating-chat-btn" class="floating-chat-btn" title="Open AI Chat" aria-label="Open AI Chat">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="currentColor"/>
        </svg>
    </button>
    
    <!-- AI Chat Drawer -->
    <div id="ai-chat-drawer" class="ai-chat-drawer hidden">
        <div class="drawer-backdrop"></div>
        <div class="drawer-content">
            <div class="drawer-header">
                <h3>AI Assistant</h3>
                <button id="close-drawer-btn" class="close-drawer-btn" title="Close chat" aria-label="Close chat">√ó</button>
            </div>
            
            <div id="chat-messages" class="chat-messages">
                <div class="chat-welcome">
                    <p>üëã Hi! I'm your AI assistant. I can help you understand your transcription and notes better.</p>
                    <p>Ask me anything about the content!</p>
                </div>
            </div>
            
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="chat-input" 
                    class="chat-input" 
                    placeholder="Ask about your transcription or notes..."
                    disabled
                    aria-label="Chat message input"
                >
                <button id="send-chat-btn" class="send-chat-btn" title="Send message" aria-label="Send message" disabled>
                    ‚û§
                </button>
            </div>
            
            <div class="chat-options">
                <label class="chat-option-label">
                    <input type="checkbox" id="include-transcription" checked>
                    <span>Include transcription context</span>
                </label>
                <label class="chat-option-label">
                    <input type="checkbox" id="include-notes" checked>
                    <span>Include notes context</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="close-settings-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <!-- Transcription Mode Section -->
                <section class="settings-section">
                    <h3>Transcription Mode</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="simulation" id="mode-simulation" checked>
                            <span class="radio-text">
                                <strong>Simulation Mode</strong>
                                <small>Testing mode with fake transcription</small>
                            </span>
                        </label>
                        
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="assemblyai" id="mode-assemblyai">
                            <span class="radio-text">
                                <strong>AssemblyAI</strong>
                                <small>Real-time streaming, word-by-word display</small>
                            </span>
                        </label>
                    </div>
                    <p class="help-text">
                        Simulation mode is for testing. AssemblyAI provides real-time streaming transcription with word-by-word display.
                    </p>
                </section>
                
                <!-- AssemblyAI Settings Section -->
                <section class="settings-section" id="assemblyai-settings">
                    <h3>AssemblyAI Configuration</h3>
                    <div class="form-group">
                        <label for="assemblyai-api-key">API Key:</label>
                        <input 
                            type="password" 
                            id="assemblyai-api-key" 
                            class="text-input" 
                            placeholder="Enter your AssemblyAI API key"
                        >
                        <small class="help-text">
                            Get your API key from <a href="https://www.assemblyai.com/dashboard/signup" target="_blank">AssemblyAI Dashboard</a>
                        </small>
                    </div>
                    <div class="status-row">
                        <label>Status:</label>
                        <span id="assemblyai-status" class="status-text">Not configured</span>
                    </div>
                </section>
                
                <!-- Claude AI Settings Section -->
                <section class="settings-section" id="claude-ai-settings">
                    <h3>Claude AI Configuration</h3>
                    <div class="form-group">
                        <label for="claude-api-key">API Key:</label>
                        <input 
                            type="password" 
                            id="claude-api-key" 
                            class="text-input" 
                            placeholder="Enter your Claude API key"
                        >
                        <small class="help-text">
                            Get your API key from <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a>
                        </small>
                    </div>
                    <div class="status-row">
                        <label>Status:</label>
                        <span id="claude-status" class="status-text">Not configured</span>
                    </div>
                    <div class="button-row">
                        <button id="test-claude-connection" class="button button-secondary" type="button">
                            Test Connection
                        </button>
                    </div>
                    <p class="help-text">
                        Claude AI powers intelligent features: chat assistance, transcription polishing, 
                        smart summaries, and automatic title generation.
                    </p>
                </section>
                
                <!-- Vosk Model Settings Section (Dynamic) -->
                <div id="vosk-model-settings-container"></div>
                
                <!-- Audio Settings Section -->
                <section class="settings-section">
                    <h3>Audio Configuration</h3>
                    
                    <div class="info-row">
                        <span class="info-label">Sample Rate:</span>
                        <span class="info-value" id="sample-rate-display">16000 Hz (Vosk required)</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Audio Format:</span>
                        <span class="info-value">PCM 16-bit Mono</span>
                    </div>
                </section>
            </div>
            
            <div class="modal-footer">
                <button id="cancel-settings-btn" class="secondary-btn">Cancel</button>
                <button id="save-settings-btn" class="primary-btn">Save Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Model URL Edit Modal -->
    <div id="model-url-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Model URL</h2>
                <button id="close-model-url-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="model-url-input">Model URL:</label>
                    <input 
                        type="text" 
                        id="model-url-input" 
                        class="text-input" 
                        placeholder="http://localhost:8000/vosk-model-small-en-us-0.15"
                    >
                    <small class="help-text">
                        Enter the HTTP URL where your Vosk model is served
                    </small>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="cancel-model-url-btn" class="secondary-btn">Cancel</button>
                <button id="save-model-url-btn" class="primary-btn">Save URL</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="app.js"></script>
</body>
</html>
