<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' http://localhost:* ws://localhost:* https://api.assemblyai.com wss://api.assemblyai.com wss://streaming.assemblyai.com https://api.anthropic.com https://djlvwxmakxaffdqbuwkv.supabase.co data: blob:; font-src 'self' data:; worker-src 'self' blob: data:;">
    <title>ScribeCat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Top Control Bar -->
        <header class="top-bar">
            <div class="app-title">
                <img src="../../assets/nugget-logo.PNG" alt="ScribeCat Logo" class="app-logo">
                <h1>ScribeCat</h1>
            </div>
            
            <div class="header-actions">
                <button id="signin-btn" class="icon-btn signin-btn" title="Sign In">
                    <span class="signin-icon">üë§</span>
                </button>

                <button id="study-mode-btn" class="icon-btn" title="Study Mode">
                    <span class="study-icon">üìö</span>
                </button>

                <button id="settings-btn" class="icon-btn" title="Settings">
                    <span class="settings-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Left Panel: Notes Editor -->
            <div class="left-panel">
                <div class="panel-header">
                    <h2>Notes</h2>
                    <div class="panel-actions">
                        <button id="toggle-toolbar-btn" class="action-btn action-btn-icon" title="Show advanced formatting toolbar">
                            üé®
                        </button>
                        <select id="course-select" class="course-select-dropdown" title="Select Course (Optional)">
                            <option value="">No Course Selected</option>
                        </select>
                        <button id="clear-notes-btn" class="action-btn action-btn-icon" title="Clear notes" disabled>
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                
                <div class="formatting-toolbar">
                    <!-- Text Style Group -->
                    <div class="toolbar-group">
                        <button id="bold-btn" class="toolbar-btn" title="Bold ‚Ä¢ Ctrl+B">
                            <span class="btn-icon bold-icon">B</span>
                        </button>
                        <button id="italic-btn" class="toolbar-btn" title="Italic ‚Ä¢ Ctrl+I">
                            <span class="btn-icon italic-icon">I</span>
                        </button>
                        <button id="underline-btn" class="toolbar-btn" title="Underline ‚Ä¢ Ctrl+U">
                            <span class="btn-icon underline-icon">U</span>
                        </button>
                        <button id="strike-btn" class="toolbar-btn" title="Strikethrough ‚Ä¢ Ctrl+Shift+S">
                            <span class="btn-icon strike-icon">S</span>
                        </button>
                        <button id="superscript-btn" class="toolbar-btn" title="Superscript">
                            <span class="btn-icon superscript-icon">X¬≤</span>
                        </button>
                        <button id="subscript-btn" class="toolbar-btn" title="Subscript">
                            <span class="btn-icon subscript-icon">X‚ÇÇ</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Color & Font Size Group -->
                    <div class="toolbar-group">
                        <div class="toolbar-dropdown">
                            <button id="color-btn" class="toolbar-btn" title="Text Color">
                                <span class="btn-icon">A</span>
                            </button>
                            <div id="color-palette" class="color-palette">
                                <div class="color-swatch" data-color="#000000" style="background: #000000;" title="Black"></div>
                                <div class="color-swatch" data-color="#FF0000" style="background: #FF0000;" title="Red"></div>
                                <div class="color-swatch" data-color="#00FF00" style="background: #00FF00;" title="Green"></div>
                                <div class="color-swatch" data-color="#0000FF" style="background: #0000FF;" title="Blue"></div>
                                <div class="color-swatch" data-color="#FFFF00" style="background: #FFFF00;" title="Yellow"></div>
                                <div class="color-swatch" data-color="#FF00FF" style="background: #FF00FF;" title="Magenta"></div>
                                <div class="color-swatch" data-color="#00FFFF" style="background: #00FFFF;" title="Cyan"></div>
                                <div class="color-swatch" data-color="#FFA500" style="background: #FFA500;" title="Orange"></div>
                                <div class="color-swatch" data-color="#800080" style="background: #800080;" title="Purple"></div>
                                <div class="color-swatch" data-color="#008000" style="background: #008000;" title="Dark Green"></div>
                            </div>
                        </div>
                        <div class="toolbar-dropdown">
                            <button id="bg-color-btn" class="toolbar-btn" title="Background Color">
                                <span class="btn-icon">üé®</span>
                            </button>
                            <div id="bg-color-palette" class="color-palette">
                                <div class="color-swatch" data-color="#FFFFFF" style="background: #FFFFFF; border: 2px solid #ddd;" title="White"></div>
                                <div class="color-swatch" data-color="#FFEB3B" style="background: #FFEB3B;" title="Yellow"></div>
                                <div class="color-swatch" data-color="#FFCDD2" style="background: #FFCDD2;" title="Light Red"></div>
                                <div class="color-swatch" data-color="#B3E5FC" style="background: #B3E5FC;" title="Light Blue"></div>
                                <div class="color-swatch" data-color="#C8E6C9" style="background: #C8E6C9;" title="Light Green"></div>
                                <div class="color-swatch" data-color="#F8BBD0" style="background: #F8BBD0;" title="Light Pink"></div>
                                <div class="color-swatch" data-color="#FFE0B2" style="background: #FFE0B2;" title="Light Orange"></div>
                                <div class="color-swatch" data-color="#E1BEE7" style="background: #E1BEE7;" title="Light Purple"></div>
                                <div class="color-swatch" data-color="#D1C4E9" style="background: #D1C4E9;" title="Light Indigo"></div>
                                <div class="color-swatch" data-color="#DCEDC8" style="background: #DCEDC8;" title="Light Lime"></div>
                            </div>
                        </div>
                        <select id="font-size-select" class="font-size-select" title="Font Size">
                            <option value="">Size</option>
                            <option value="12px">12px</option>
                            <option value="14px">14px</option>
                            <option value="16px">16px</option>
                            <option value="18px">18px</option>
                            <option value="20px">20px</option>
                            <option value="24px">24px</option>
                            <option value="28px">28px</option>
                            <option value="32px">32px</option>
                        </select>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Text Align Group -->
                    <div class="toolbar-group">
                        <button id="align-left-btn" class="toolbar-btn" title="Align Left">
                            <span class="btn-icon align-icon align-left">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-center-btn" class="toolbar-btn" title="Align Center">
                            <span class="btn-icon align-icon align-center">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-right-btn" class="toolbar-btn" title="Align Right">
                            <span class="btn-icon align-icon align-right">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                        <button id="align-justify-btn" class="toolbar-btn" title="Justify">
                            <span class="btn-icon align-icon align-justify">
                                <span></span>
                                <span></span>
                                <span></span>
                            </span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Headings Group -->
                    <div class="toolbar-group">
                        <button id="heading1-btn" class="toolbar-btn" title="Heading 1 ‚Ä¢ Ctrl+Shift+H">
                            <span class="btn-icon">H1</span>
                        </button>
                        <button id="heading2-btn" class="toolbar-btn" title="Heading 2 ‚Ä¢ Ctrl+Alt+H">
                            <span class="btn-icon">H2</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- List Group -->
                    <div class="toolbar-group">
                        <button id="bullet-list-btn" class="toolbar-btn" title="Bullet List ‚Ä¢ Ctrl+Shift+8">
                            <span class="btn-icon list-icon">
                                <span class="list-bullet">‚Ä¢</span>
                                <span class="list-lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </span>
                            </span>
                        </button>
                        <button id="numbered-list-btn" class="toolbar-btn" title="Numbered List ‚Ä¢ Ctrl+Shift+7">
                            <span class="btn-icon list-icon">
                                <span class="list-number">1.</span>
                                <span class="list-lines">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </span>
                            </span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Insert Group -->
                    <div class="toolbar-group">
                        <button id="link-btn" class="toolbar-btn" title="Add Link">
                            <span class="btn-icon">üîó</span>
                        </button>
                        <button id="image-btn" class="toolbar-btn" title="Insert Image">
                            <span class="btn-icon">üñºÔ∏è</span>
                        </button>
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                        <button id="insert-table-btn" class="toolbar-btn" title="Insert Table">
                            <span class="btn-icon">‚äû</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- History Group -->
                    <div class="toolbar-group">
                        <button id="undo-btn" class="toolbar-btn" title="Undo ‚Ä¢ Ctrl+Z">
                            <span class="btn-icon">‚Ü∂</span>
                        </button>
                        <button id="redo-btn" class="toolbar-btn" title="Redo ‚Ä¢ Ctrl+Y">
                            <span class="btn-icon">‚Ü∑</span>
                        </button>
                    </div>

                    <div class="toolbar-divider"></div>

                    <!-- Clear Format -->
                    <button id="clear-format-btn" class="toolbar-btn" title="Clear Formatting">
                        <span class="btn-icon">‚úï</span>
                    </button>
                </div>

                <!-- Table Toolbar (contextual - only shows when in table) -->
                <div id="table-toolbar" class="table-toolbar" style="display: none;">
                    <div class="toolbar-group">
                        <button id="add-row-before-btn" class="toolbar-btn" title="Add Row Above">
                            <span class="btn-icon">‚¨Ü Row</span>
                        </button>
                        <button id="add-row-after-btn" class="toolbar-btn" title="Add Row Below">
                            <span class="btn-icon">‚¨á Row</span>
                        </button>
                        <button id="add-col-before-btn" class="toolbar-btn" title="Add Column Left">
                            <span class="btn-icon">‚¨Ö Col</span>
                        </button>
                        <button id="add-col-after-btn" class="toolbar-btn" title="Add Column Right">
                            <span class="btn-icon">‚û° Col</span>
                        </button>
                        <button id="delete-row-btn" class="toolbar-btn" title="Delete Row">
                            <span class="btn-icon">‚ùå Row</span>
                        </button>
                        <button id="delete-col-btn" class="toolbar-btn" title="Delete Column">
                            <span class="btn-icon">‚ùå Col</span>
                        </button>
                        <button id="delete-table-btn" class="toolbar-btn" title="Delete Table">
                            <span class="btn-icon">üóë Table</span>
                        </button>
                    </div>
                </div>
                
                <div id="tiptap-editor" class="tiptap-editor"></div>
                
                <div class="editor-footer">
                    <span id="char-count" class="count-display">0 characters</span>
                    <span class="count-separator">‚Ä¢</span>
                    <span id="word-count" class="count-display">0 words</span>
                </div>
            </div>
            
            <!-- Right Panel: Live Transcription -->
            <div class="right-panel">
                <div class="panel-header">
                    <h2>Live Transcription</h2>
                    <div class="panel-actions">
                        <button id="clear-transcription-btn" class="action-btn action-btn-icon" title="Clear transcription" disabled>
                            üóëÔ∏è
                        </button>
                        <button id="clear-both-btn" class="action-btn action-btn-icon clear-both-btn" title="Clear both notes and transcription" disabled>
                            ‚ö†Ô∏è
                        </button>
                    </div>
                </div>
                
                <div class="recording-controls-bar">
                    <button id="record-btn" class="record-btn" title="Start Recording">
                        <span class="record-icon"></span>
                    </button>
                    
                    <button id="pause-btn" class="pause-btn" title="Pause Recording" disabled>
                        <span class="pause-icon">‚è∏</span>
                    </button>
                    
                    <select id="microphone-select" class="device-select" title="Select Microphone">
                        <option value="">üê± Cats can rotate their ears 180 degrees...</option>
                    </select>
                    
                    <div class="vu-meter-container">
                        <div class="vu-meter-bg">
                            <div id="vu-meter" class="vu-meter"></div>
                        </div>
                    </div>
                </div>
                
                <div id="transcription-container" class="transcription-container">
                    <div class="transcription-placeholder" id="transcription-placeholder">
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Study Mode View -->
        <div id="study-mode-view" class="study-mode-view hidden">
            <div class="study-mode-header">
                <h2>üìö Study Mode</h2>
                <div class="study-mode-header-actions">
                    <div id="online-status-indicator" class="online-status-indicator online">
                        <span class="status-dot"></span>
                        <span class="status-text">Online</span>
                    </div>
                    <button id="trash-btn" class="secondary-btn" title="View trash">
                        üóëÔ∏è Trash
                    </button>
                    <button id="sync-now-btn" class="secondary-btn" title="Sync with cloud">
                        <span class="sync-icon">‚òÅÔ∏è</span> Sync Now
                    </button>
                    <button id="back-to-record-btn" class="secondary-btn">‚Üê Back to Recording</button>
                </div>
            </div>
            
            <div class="study-mode-filters">
                <input 
                    type="text" 
                    id="study-search-input" 
                    class="filter-input" 
                    placeholder="üîç Search sessions..."
                    aria-label="Search sessions"
                >
                <select id="study-course-filter" class="filter-select" aria-label="Filter by course">
                    <option value="">All Courses</option>
                </select>
                <select id="study-sort-select" class="filter-select" aria-label="Sort sessions">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="longest">Longest First</option>
                    <option value="shortest">Shortest First</option>
                </select>
            </div>
            
            <div class="bulk-actions-bar hidden" id="bulk-actions-bar">
                <div class="bulk-actions-left">
                    <label class="checkbox-label">
                        <input type="checkbox" id="select-all-sessions">
                        <span id="selected-count">0 selected</span>
                    </label>
                </div>
                <div class="bulk-actions-right">
                    <button id="create-study-set-btn" class="action-btn study-set-btn" disabled>
                        üìö Create Study Set
                    </button>
                    <button id="bulk-export-btn" class="action-btn" disabled>
                        üì§ Export Selected
                    </button>
                    <button id="bulk-delete-btn" class="action-btn delete-btn" disabled>
                        üóëÔ∏è Delete Selected
                    </button>
                </div>
            </div>
            
            <div id="session-list" class="session-list">
                <!-- Session cards will be populated by JavaScript -->
            </div>
            
            <div id="session-detail" class="session-detail hidden">
                <!-- Session detail view will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Bottom Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-label">Status:</span>
                <span id="recording-status" class="status-value">Idle</span>
                <span id="transcription-mode" class="mode-indicator"></span>
            </div>
            
            <div class="status-center">
                <span class="status-label">Time:</span>
                <span id="elapsed-time" class="status-value time-display">00:00</span>
            </div>
            
            <div class="status-right">
                <span id="session-info" class="status-value"></span>
            </div>
        </footer>
    </div>
    
    <!-- Floating AI Chat Button -->
    <button id="floating-chat-btn" class="floating-chat-btn" title="Open AI Chat" aria-label="Open AI Chat">
        <img src="assets/AskAI-cat.PNG" alt="AI Chat" class="chat-btn-icon">
    </button>
    
    <!-- AI Chat Drawer -->
    <div id="ai-chat-drawer" class="ai-chat-drawer hidden">
        <div class="drawer-backdrop"></div>
        <div class="drawer-content">
            <div class="drawer-header">
                <h3>AI Assistant</h3>
                <button id="close-drawer-btn" class="close-drawer-btn" title="Close chat" aria-label="Close chat">√ó</button>
            </div>
            
            <div id="chat-messages" class="chat-messages">
                <div class="chat-welcome">
                    <p>üëã Hi! I'm your AI assistant. I can help you understand your transcription and notes better.</p>
                    <p>Ask me anything about the content!</p>
                </div>
            </div>
            
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="chat-input" 
                    class="chat-input" 
                    placeholder="Ask about your transcription or notes..."
                    disabled
                    aria-label="Chat message input"
                >
                <button id="send-chat-btn" class="send-chat-btn" title="Send message" aria-label="Send message" disabled>
                    ‚û§
                </button>
            </div>
            
            <div class="chat-options">
                <label class="chat-option-label">
                    <input type="checkbox" id="include-transcription" checked>
                    <span>Include transcription context</span>
                </label>
                <label class="chat-option-label">
                    <input type="checkbox" id="include-notes" checked>
                    <span>Include notes context</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button id="close-settings-btn" class="close-btn" title="Close">√ó</button>
            </div>
            
            <div class="modal-body">
                <!-- Collapsible Group: Transcription & AI -->
                <div class="settings-group" data-group="transcription-ai">
                    <div class="settings-group-header">
                        <h2>Transcription & AI</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Transcription Mode Section -->
                        <section class="settings-section">
                            <h3>Transcription Mode</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="transcription-mode" value="assemblyai" id="mode-assemblyai" checked>
                            <span class="radio-text">
                                <strong>AssemblyAI</strong>
                                <small>Real-time streaming, word-by-word display</small>
                            </span>
                        </label>
                    </div>
                    <p class="help-text">
                        AssemblyAI provides real-time streaming transcription with word-by-word display. API key required.
                    </p>
                </section>

                        <!-- Transcription Accuracy Settings Section -->
                        <section class="settings-section">
                            <h3>Transcription Accuracy Settings</h3>
                            <p class="help-text" style="margin-bottom: 15px;">
                                Configure AssemblyAI transcription parameters for improved accuracy. These settings only apply when AssemblyAI mode is selected.
                            </p>

                            <div class="form-group">
                                <label for="speech-model-select">Speech Model:</label>
                                <select id="speech-model-select" class="text-input">
                                    <option value="best">Best Accuracy (Recommended)</option>
                                    <option value="nano">Fastest Speed</option>
                                </select>
                                <small class="help-text">
                                    "Best Accuracy" provides the highest quality transcription. Use "Fastest Speed" for quicker results with slightly lower accuracy.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="language-select">Language:</label>
                                <select id="language-select" class="text-input">
                                    <option value="">Auto-detect</option>
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="nl">Dutch</option>
                                    <option value="hi">Hindi</option>
                                    <option value="ja">Japanese</option>
                                    <option value="zh">Chinese</option>
                                    <option value="fi">Finnish</option>
                                    <option value="ko">Korean</option>
                                    <option value="pl">Polish</option>
                                    <option value="ru">Russian</option>
                                    <option value="tr">Turkish</option>
                                    <option value="uk">Ukrainian</option>
                                    <option value="vi">Vietnamese</option>
                                </select>
                                <small class="help-text">
                                    Specify the language for better accuracy, or use auto-detect.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="speaker-labels-checkbox">
                                    <span>Enable Speaker Diarization</span>
                                </label>
                                <small class="help-text">
                                    Identifies different speakers in multi-speaker scenarios (useful for lectures with Q&A).
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="disfluencies-checkbox" checked>
                                    <span>Filter Filler Words</span>
                                </label>
                                <small class="help-text">
                                    Remove "um", "uh", and other filler words for cleaner transcripts.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="punctuate-checkbox" checked>
                                    <span>Automatic Punctuation</span>
                                </label>
                                <small class="help-text">
                                    Automatically add punctuation to transcripts.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="format-text-checkbox" checked>
                                    <span>Smart Text Formatting</span>
                                </label>
                                <small class="help-text">
                                    Enable smart formatting for numbers, dates, and other entities.
                                </small>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Collapsible Group: Integrations -->
                <div class="settings-group" data-group="integrations">
                    <div class="settings-group-header">
                        <h2>Integrations</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Google Drive Settings Section -->
                        <section class="settings-section" id="google-drive-settings">
                            <h3>Google Drive Integration</h3>
                    <div class="status-row">
                        <label>Status:</label>
                        <span id="drive-status" class="status-text">Not connected</span>
                    </div>
                    <div class="button-row">
                        <button id="connect-drive-btn" class="button button-primary" type="button">
                            Connect Google Drive
                        </button>
                        <button id="disconnect-drive-btn" class="button button-secondary" type="button" style="display: none;">
                            Disconnect
                        </button>
                    </div>
                    <p class="help-text">
                        Connect your Google Drive to automatically upload exported sessions. 
                        You'll be asked to sign in with your Google account.
                    </p>
                </section>
                
                <!-- Canvas LMS Settings Section -->
                <section class="settings-section" id="canvas-settings">
                    <h3>Canvas LMS Integration</h3>
                    
                    <!-- API Connection Method -->
                    <div class="canvas-method">
                        <h4>Method 1: Canvas API (Recommended)</h4>
                        <div class="form-group">
                            <label for="canvas-url">Canvas URL:</label>
                            <input 
                                type="text" 
                                id="canvas-url" 
                                class="text-input" 
                                placeholder="https://canvas.instructure.com"
                            >
                            <small class="help-text">
                                Enter your institution's Canvas URL (e.g., https://canvas.university.edu)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="canvas-token">API Token:</label>
                            <input 
                                type="password" 
                                id="canvas-token" 
                                class="text-input" 
                                placeholder="Enter your Canvas API token"
                            >
                            <small class="help-text">
                                Get your API token from Canvas: Account ‚Üí Settings ‚Üí New Access Token
                            </small>
                        </div>
                        <div class="status-row">
                            <label>Status:</label>
                            <span id="canvas-status" class="status-text">Not configured</span>
                        </div>
                        <div class="button-row">
                            <button id="test-canvas-btn" class="button button-secondary" type="button">
                                Test Connection
                            </button>
                            <button id="disconnect-canvas-btn" class="button button-secondary" type="button" style="display: none;">
                                Disconnect
                            </button>
                        </div>
                    </div>
                    
                    <!-- Browser Extension Import Method -->
                    <div class="canvas-method" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #444;">
                        <h4>Method 2: Browser Extension Import</h4>
                        <p class="help-text">
                            If your university blocks Canvas API access, use our browser extension to import courses.
                            <a href="#" id="extension-help-link" style="color: #3498db;">Learn more</a>
                        </p>
                        <div class="form-group">
                            <label for="canvas-import-json">Paste JSON from Extension:</label>
                            <textarea 
                                id="canvas-import-json" 
                                class="text-input" 
                                rows="4"
                                placeholder='{"source": "ScribeCat Canvas Browser Extension", "format": "scribecat_course_import_v1", "courses": [...]}'
                            ></textarea>
                            <small class="help-text">
                                Install the extension, visit your Canvas dashboard, export courses, then paste the JSON here.
                            </small>
                        </div>
                        <div class="button-row">
                            <button id="import-canvas-courses-btn" class="button button-primary" type="button">
                                Import Courses
                            </button>
                        </div>
                        
                        <!-- Imported Courses List -->
                        <div id="imported-courses-container" style="margin-top: 20px; display: none;">
                            <h5>Imported Courses (<span id="imported-courses-count">0</span>)</h5>
                            <div id="imported-courses-list" class="courses-list"></div>
                        </div>
                    </div>
                </section>
                    </div>
                </div>

                <!-- Collapsible Group: Appearance -->
                <div class="settings-group" data-group="appearance">
                    <div class="settings-group-header">
                        <h2>Appearance</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Workspace Layout Section -->
                        <section class="settings-section">
                            <h3>Workspace Layout</h3>
                            <p class="help-text">
                                Customize your workspace layout with presets or create your own. Drag the divider between panels to resize.
                            </p>
                            <div class="button-row">
                                <button id="open-layout-picker-btn" class="button button-primary" type="button">
                                    ‚äû Manage Workspace Layouts
                                </button>
                            </div>
                        </section>

                        <!-- Theme Settings Section -->
                        <section class="settings-section">
                            <h3>Theme</h3>
                    <p class="help-text">
                        Choose a theme that matches your mood and enhances your focus. 
                        Each theme is designed using color theory to evoke specific emotions.
                    </p>
                    
                    <div class="form-group">
                        <label for="theme-category-filter">Filter by Category:</label>
                        <select id="theme-category-filter" class="text-input">
                            <option value="all">All Themes</option>
                            <option value="calm">Calm & Peaceful</option>
                            <option value="energetic">Energetic & Motivated</option>
                            <option value="focus">Focus & Productivity</option>
                            <option value="creative">Creative & Inspired</option>
                            <option value="balanced">Balanced & Harmonious</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="theme-variant-filter">Filter by Variant:</label>
                        <select id="theme-variant-filter" class="text-input">
                            <option value="all">All Variants</option>
                            <option value="dark">Dark Mode</option>
                            <option value="light">Light Mode</option>
                        </select>
                    </div>

                    <div id="theme-grid" class="theme-grid">
                        <!-- Themes will be populated by JavaScript -->
                    </div>
                </section>
                    </div>
                </div>

                <!-- Collapsible Group: Audio Configuration -->
                <div class="settings-group" data-group="audio">
                    <div class="settings-group-header">
                        <h2>Audio Configuration</h2>
                        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                        </svg>
                    </div>
                    <div class="settings-group-content">
                        <!-- Audio Settings Section -->
                        <section class="settings-section">
                            <h3>Audio Configuration</h3>
                    
                    <div class="info-row">
                        <span class="info-label">Sample Rate:</span>
                        <span class="info-value" id="sample-rate-display">16000 Hz</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Audio Format:</span>
                        <span class="info-value">PCM 16-bit Mono</span>
                    </div>
                </section>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="cancel-settings-btn" class="secondary-btn">Cancel</button>
                <button id="save-settings-btn" class="primary-btn">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Input Prompt Modal -->
    <div id="input-prompt-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="input-prompt-title">Enter Value</h2>
                <button id="close-input-prompt-btn" class="close-btn" title="Close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label id="input-prompt-label" for="input-prompt-field">Value:</label>
                    <input type="text" id="input-prompt-field" class="text-input" placeholder="">
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-input-prompt-btn" class="secondary-btn">Cancel</button>
                <button id="ok-input-prompt-btn" class="primary-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Course Selection Modal -->
    <div id="course-select-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Edit Course</h2>
                <button id="close-course-select-btn" class="close-btn" title="Close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="form-group">
                    <label for="course-select-dropdown">Select Course:</label>
                    <select id="course-select-dropdown" class="course-select-dropdown">
                        <option value="">No Course Selected</option>
                    </select>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancel-course-select-btn" class="secondary-btn">Cancel</button>
                <button id="ok-course-select-btn" class="primary-btn">OK</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
